@prefix era-sh: <http://data.europa.eu/949/shapes/> .
@prefix ex: <http://example.org/ns#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix era: <http://data.europa.eu/949/> .
@prefix  era-cls: <http://data.europa.eu/949/concepts/contact-line-systems/> .
@prefix  era-ess: <http://data.europa.eu/949/concepts/energy-supply-systems/> .
@prefix skos:<http://www.w3.org/2004/02/skos/core#> .
#############################
# Rules for contact-line-systems
#############################

era-sh:ETCSShape  
    a sh:NodeShape ;
    sh:targetClass era:ETCS .

# etcsBaseline: # 1.1.1.3.2.2, 1.2.1.1.1.2
era-sh:ETCSShape sh:property era-sh:etcsBaseline .
era-sh:etcsBaseline
	a sh:PropertyShape ;
    era:affectedProperty era:etcsBaseline;
    era:affectedClass era:ETCS;
    era:scope "local";
	rdfs:comment "ETCS baseline installed lineside" ;
	era:rinfIndex "1.1.1.3.2.2" ;
    era:rinfIndex "1.2.1.1.1.2" ;
	sh:path era:etcsBaseline ;
	sh:nodeKind sh:IRI ;
    sh:maxCount 1;
	sh:severity sh:Violation ;
	sh:message "etcsBaseline (1.1.1.3.2.2, 1.2.1.1.1.2): The ETCS may have an ETCS baseline, and its value must be an IRI. This error is due to the ETCS instance having more than one value or having a value that is not an IRI."@en .

# etcsBaseline: # 1.1.1.3.2.2, 1.2.1.1.1.2
era-sh:ETCSShape sh:sparql era-sh:etcsBaselineSKOS .
era-sh:etcsBaselineSKOS
	a sh:SPARQLConstraint ;
    era:affectedProperty era:etcsBaseline;
    era:affectedClass era:ETCS;
    era:scope "local";
	rdfs:comment "ETCS baseline installed lineside" ;
	era:rinfIndex "1.1.1.3.2.2" ;
    era:rinfIndex "1.2.1.1.1.2" ;
	sh:severity sh:Violation ;
	sh:message "etcsBaseline (1.1.1.3.2.2, 1.2.1.1.1.2): The ETCS {$this}  has a value {?concept} that is not one of the predefined values and cannot be converted into a SKOS concept on this list: http://data.europa.eu/949/concepts/etcs-baselines/."@en ;
    sh:prefixes era:;
	sh:select """
    PREFIX era: <http://data.europa.eu/949/>
    PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
    SELECT $this  ?concept
    WHERE {
        $this era:etcsBaseline ?concept .
        era:etcsBaseline era:inSkosConceptScheme ?conceptScheme .
		FILTER (NOT EXISTS {?concept skos:inScheme ?conceptScheme} || REGEX(?concept, "/eratv/"))
	}
""" .


# etcsInfill: # 1.1.1.3.2.4, 1.2.1.1.1.4
era-sh:ETCSShape sh:property era-sh:etcsInfill .
era-sh:etcsInfill
	a sh:PropertyShape ;
    era:affectedProperty era:etcsInfill;
    era:affectedClass era:ETCS;
    era:scope "local";
	rdfs:comment "Information about installed trackside equipment capable of transmitting infill information by loop or Global System for Mobile communications for Railways (GSM-R) for level 1 installations." ;
	era:rinfIndex "1.1.1.3.2.4" ;
    era:rinfIndex "1.2.1.1.1.4" ;
	sh:path era:etcsInfill ;
	sh:nodeKind sh:IRI ;
    sh:maxCount 1;
	sh:severity sh:Violation ;
	sh:message "etcsInfill (1.1.1.3.2.4, 1.2.1.1.1.4): The ETCS may have an ETCS infill, and its value must be an IRI. This error is due to the ETCS instance having more than one value or having a value that is not an IRI."@en .

# etcsInfill: # 1.1.1.3.2.4, 1.2.1.1.1.4
era-sh:ETCSShape sh:sparql era-sh:etcsInfillSKOS .
era-sh:etcsInfillSKOS
	a sh:SPARQLConstraint ;
    era:affectedProperty era:etcsInfill;
    era:affectedClass era:ETCS;
    era:scope "local";
	rdfs:comment "Information about installed trackside equipment capable of transmitting infill information by loop or Global System for Mobile communications for Railways (GSM-R) for level 1 installations." ;
	era:rinfIndex "1.1.1.3.2.4" ;
    era:rinfIndex "1.2.1.1.1.4" ;
	sh:severity sh:Violation ;
	sh:message "etcsInfill (1.1.1.3.2.4, 1.2.1.1.1.4): The ETCS {$this}  has a value {?concept} that is not one of the predefined values and cannot be converted into a SKOS concept on this list: http://data.europa.eu/949/concepts/etcs-infills/."@en ;
    sh:prefixes era:;
	sh:select """
    PREFIX era: <http://data.europa.eu/949/>
    PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
    SELECT $this  ?concept
    WHERE {
        $this era:etcsInfill ?concept .
        era:etcsInfill era:inSkosConceptScheme ?conceptScheme .
		FILTER (NOT EXISTS {?concept skos:inScheme ?conceptScheme} || REGEX(?concept, "/eratv/"))
	}
""" .

# etcsMVersion: # 1.1.1.3.2.10, 1.2.1.1.1.10
era-sh:ETCSShape sh:property era-sh:EtcsMVersion.
era-sh:EtcsMVersion
	a sh:PropertyShape ; era:affectedProperty era:etcsMVersion  ;     era:affectedClass  era:ETCS;     era:scope "local";     
	rdfs:comment "ETCS_M version according to SRS 7.5.1.9" ;
	era:rinfIndex "1.1.1.3.2.10" ;
    era:rinfIndex "1.2.1.1.1.10" ;
	sh:path era:etcsMVersion ;
	##sh:minCount 0 ; #TODO: Not yet applicable
	sh:maxCount 1 ;
	sh:nodeKind sh:IRI ;
	sh:severity sh:Violation ;
	sh:message "etcsMVersion (1.1.1.3.2.10, 1.2.1.1.1.10): The ETCS has at most one ETCS_M version value and it must be an IRI. This error is due to the track having more than one value or having a value that is not an IRI."@en .

# etcsMVersion: # 1.1.1.3.2.10, 1.2.1.1.1.10
era-sh:ETCSShape sh:sparql era-sh:EtcsMVersionSKOS.
era-sh:EtcsMVersionSKOS
	a sh:SPARQLConstraint ;
    era:affectedProperty era:etcsMVersion  ;     era:affectedClass  era:ETCS;     era:scope "local";     
    rdfs:comment "ETCS_M version according to SRS 7.5.1.9" ;
	era:rinfIndex "1.1.1.3.2.10" ;
    era:rinfIndex "1.1.1.3.2.10" ;
	sh:severity sh:Violation ;
    sh:message "Indication of the etcsMVersion (1.1.1.3.2.10, 1.1.1.3.2.10):): The ETCS {$this}  has a value {?concept} that is not one of the predefined values and cannot be converted into a SKOS concept on this list: http://data.europa.eu/949/concepts/etcs-m-versions/ETCSMVersions."@en ;
    sh:prefixes era:;
	sh:select """
    PREFIX era: <http://data.europa.eu/949/>
    PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    SELECT $this  ?concept
    WHERE {
        $this era:etcsMVersion ?concept .
        era:etcsMVersion era:inSkosConceptScheme ?conceptScheme .
		FILTER NOT EXISTS{         
  			?concept skos:inScheme ?conceptScheme .
		}
	}
""" .

# etcsLevelType: # 1.1.1.3.2.1, 1.2.1.1.1.1
era-sh:ETCSShape sh:property era-sh:EtcsLevelType.
era-sh:EtcsLevelType
	a sh:PropertyShape ; era:affectedProperty era:etcsLevelType  ;     era:affectedClass  era:ETCS;     era:scope "local";     
	rdfs:comment "Indicates the type associated as a SKOS concept from the era:ETCSLevel related to the track side equipment." ;
	era:rinfIndex "1.1.1.3.2.1" ;
    era:rinfIndex "1.2.1.1.1.1" ;
	sh:path era:etcsLevelType ;
	sh:maxCount 1 ;
	sh:nodeKind sh:IRI ;
	sh:severity sh:Violation ;
	sh:message "etcsLevelType (1.1.1.3.2.1, 1.2.1.1.1.1): The ETCS has at most one etcsLevelType value and it must be an IRI. This error is due to the track having more than one value or having a value that is not an IRI."@en .

# etcsLevelType: # 1.1.1.3.2.1, 1.2.1.1.1.1
era-sh:ETCSShape sh:sparql era-sh:EtcsLevelTypeSKOS.
era-sh:EtcsLevelTypeSKOS
	a sh:SPARQLConstraint ;
    era:affectedProperty era:etcsLevelType  ;     era:affectedClass  era:ETCS;     era:scope "local";     
    rdfs:comment "Indicates the type associated as a SKOS concept from the era:ETCSLevel related to the track side equipment." ;
	era:rinfIndex "1.1.1.3.2.10" ;
    era:rinfIndex "1.2.1.1.1.1" ;
	sh:severity sh:Violation ;
    sh:message "Indication of the etcsLevelType (1.1.1.3.2.1, 1.2.1.1.1.1): The ETCS {$this}  has a value {?concept} that is not one of the predefined values and cannot be converted into a SKOS concept on this list: http://data.europa.eu/949/concepts/etcs-levels/."@en ;
    sh:prefixes era:;
	sh:select """
    PREFIX era: <http://data.europa.eu/949/>
    PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    SELECT $this  ?concept
    WHERE {
        $this era:etcsLevelType ?concept .
        era:etcsLevelType era:inSkosConceptScheme ?conceptScheme .
		FILTER NOT EXISTS{         
  			?concept skos:inScheme ?conceptScheme .
		}
	}
""" .






